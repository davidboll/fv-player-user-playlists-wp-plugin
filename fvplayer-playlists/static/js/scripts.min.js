function fvpupe_save_videos_order(){if($wrapper=$("[data-fvupe-edit-playlist-video-list]"),$wrapper.length>0){var t=[],e=$wrapper.attr("data-fvupe-edit-playlist-video-list");$wrapper.find("[data-fvpupe-video-id]").each((function(){var e=$(this).attr("data-fvpupe-video-id"),a=$(this).attr("data-fvpupe-page-id");t.push({video_id:e,page_id:a})}));var a={action:"ajaxSaveVideosOrder",order:t,playlist_id:e};$.post(ajax.url,a,(function(t){var e=$.parseJSON(t);fvpupe_set_message(e.message,e.status)}))}}function fvpupe_save_playlist_order(){if($wrapper=$("[data-fvpupe-userplaylist-list]"),$wrapper.length>0){var t=[];$wrapper.find("[data-fvpupe-userplaylist]").each((function(){var e=$(this).attr("data-fvpupe-userplaylist");t.push(e)}));var e={action:"ajaxSavePlaylistOrder",order:t};$.post(ajax.url,e,(function(t){var e=$.parseJSON(t);fvpupe_set_message(e.message,e.status)}))}}function fvpupe_same_height_children(){$=jQuery,$("[data-fvpupe-same-height-children]").each((function(){var t=$(this),e=0,a=t.children();a.css("height","auto"),a.each((function(){var t=$(this).height();t>e&&(e=t)})),a.css("height",e+"px")}))}function fvpupe_playlist_form(t){var e='data-fvpupe-aftersave="fvpupe_close_modal"';0!=t.playlist_id&&(e=t.from_single?'data-fvpupe-aftersave="fvpupe_reload_page fvpupe_close_modal"':'data-fvpupe-aftersave="fvpupe_set_playlist_name fvpupe_close_modal"');var a=0!=t.playlist_id?ajax.lang.edit_playlist:ajax.lang.create_new_playlist,p=0!=t.playlist_id?"data-fvpupe-closemodal":'data-fvpupe-toggle-button="group" data-fvpupe-toggle-value="add_to_playlist"',l=void 0!==t.name?t.name:"",i=void 0!==t.description?t.description:"",s="";return void 0!==t.videos&&Object.keys(t.videos).length>0&&(s+='<div class="fvpupe-edit-playlist-video-list-wrapper">',s+="<h3>"+ajax.lang.videos+"</h3>",s+='<ul class="fvpupe-list fvpupe-edit-playlist-video-list" data-fvpupe-sortable-videos data-fvupe-edit-playlist-video-list="'+t.playlist_id+'">',$.each(t.videos,(function(t,e){s+='<li data-fvpupe-video-id="'+e.video_id+'" data-fvpupe-page-id="'+e.page_id+'">',s+='<div class="fvpupe-order-handle-updown"><svg class="fvpupe-order-handle-updown-svg" xmlns="http://www.w3.org/2000/svg" width="41.781" height="83.5" viewBox="0 0 41.781 83.5"><path d="M105.1,272.975a3.938,3.938,0,0,0-3.593-2.351H88.445V239.273h13.062a3.574,3.574,0,0,0,3.446-2.353,3.921,3.921,0,0,0-.72-4.232L87.252,214.4a3.4,3.4,0,0,0-2.726-1.2,3.912,3.912,0,0,0-2.872,1.2L64.672,232.688a3.918,3.918,0,0,0,2.872,6.585H80.607v31.351H67.544a3.919,3.919,0,0,0-2.873,6.585L81.506,295.5a4.046,4.046,0,0,0,5.746,0l16.982-18.289A3.711,3.711,0,0,0,105.1,272.975Z" transform="translate(-63.625 -213.188)"/></svg></div>',s+=e.page_title,s+='<div class="fvpupe-delete-video" data-fvpupe-delete-video-from-playlist><svg class="fvpupe-delete-svg" xmlns="http://www.w3.org/2000/svg" width="31.219" height="31.313" viewBox="0 0 31.219 31.313"><path d="M99.1,77.371a2.344,2.344,0,1,1-3.314,3.314L84.25,69.061,72.629,80.682a2.344,2.344,0,0,1-3.314-3.314L80.94,65.75,69.311,54.041a2.344,2.344,0,1,1,3.314-3.314L84.25,62.44,95.871,50.818a2.344,2.344,0,0,1,3.314,3.314L87.561,65.75Z" transform="translate(-68.656 -50.063)"/></svg></div>',s+="</li>"})),s+="</ul>",s+="</div>"),`\n\t\t<form method="post" action="ajaxSaveUserPlaylist" ${e} data-fvpupe-saveform>\n\t\t\t<h2>${a}</h2>\n\t\t\t<div class="fvpupe-input">\n\t\t\t\t<label>\n\t\t\t\t\t<div class="fvpupe-label">${ajax.lang.playlist_name}*</div>\n\t\t\t\t\t<input type="text" name="fvpupe-playlist-name" value="${l}" />\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t\t<div class="fvpupe-input">\n\t\t\t\t<label>\n\t\t\t\t\t<div class="fvpupe-label">${ajax.lang.description}</div>\n\t\t\t\t\t<textarea name="fvpupe-playlist-description" cols="10" rows="10">${i}</textarea>\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t\t<a href="#" class="fvpupe-button fvpupe-positive" data-fvpupe-submit>${ajax.lang.save}</a> \n\t\t\t<a href="#" class="fvpupe-button fvpupe-neutral" ${p}>${ajax.lang.cancel}</a>\n\t\t\t<input type="hidden" name="fvpupe-videoid" value="${t.video_id}" />\n\t\t\t<input type="hidden" name="fvpupe-pageid" value="${t.page_id}" />\n\t\t\t<input type="hidden" name="fvpupe-playlistid" value="${t.playlist_id}" />\n\t\t</form>\n\t\t${s}\n\t`}function fvpupe_reload_page(){location.reload()}function fvpupe_set_playlist_name(t,e){$=jQuery,$('[data-fvpupe-userplaylist="'+e+'"] [data-fvpupe-playlistname]').text(t)}function fvpupe_create_modal(t){$=jQuery,$("[data-fvpupe-modal]").remove();var e=$('<div data-fvpupe-modal class="fvpupe-modal-wrapper"><div data-fvpupe-modal-overlay class="fvpupe-modal-overlay"></div><div data-fvpupe-modal-content-wrapper class="fvpupe-modal-content"><div data-fvpupe-modal-close-button class="fvpupe-close-button"></div><div data-fvpupe-modal-content></div></div></div>');return $("body").append(e),e.fadeIn(200),void 0!==t&&fvpupe_set_modal_content(t,!1),e}function fvpupe_set_modal_content(t,e){$=jQuery;var a=$("[data-fvpupe-modal-content]");e?a.fadeOut(200,(function(){a.html(t),a.fadeIn(200)})):a.html(t)}function fvpupe_close_modal(){$=jQuery,$("[data-fvpupe-modal]").fadeOut(200,(function(){$("[data-fvpupe-modal]").remove()}))}function fvpupe_set_message(t,e){$=jQuery;var a=$("[data-fvpupe-message-wrapper]");0==a.length&&(a=$('<div data-fvpupe-message-wrapper class="fvpupe-message-wrapper"></div>'),$("body").append(a));var p=$('<div data-fvpupe-message class="fvpupe-message fvpupe-message-type-'+(1==e?"success":"error")+'">'+t+"</div>");a.append(p),p.fadeIn(200),setTimeout((function(){p.fadeOut(200,(function(){p.remove()}))}),5e3)}jQuery((function(t){fvpupe_same_height_children(),t(window).load((function(){fvpupe_same_height_children()})),t(window).resize((function(){fvpupe_same_height_children()})),t("[data-fvpupe-sortable-playlist]").sortable({placeholder:"fvpupe-sortable-placeholder",handle:".fvpupe-order-handle",change:function(t,e){fvpupe_same_height_children()},start:function(t,e){fvpupe_same_height_children()},stop:function(t,e){fvpupe_save_playlist_order()}}),t("[data-fvpupe-sortable-playlist]").disableSelection(),t("body").on("click","[data-fvpupe-add-to-playlist]",(function(e){e.preventDefault(),fvpupe_create_modal(ajax.lang.loading+"...");var a=t(this).attr("data-fvpupe-video-id"),p=t(this).attr("data-fvpupe-page-id");t.post(ajax.url,{action:"ajaxGetUserPlaylists"},(function(e){var l=t.parseJSON(e),i="";i+='<div class="fvpupe-form" data-fvpupe-toggle="group" data-fvpupe-toggle-value="add_to_playlist">',2!=l.status&&3!=l.status||(i+=`\n\t\t\t\t\t<h2>${ajax.lang.add_to_playlist}</h2>\n\t\t\t\t\t<p>${l.message}</p>\n\t\t\t\t`),1==l.status&&(i+="<h2>"+ajax.lang.add_to_playlist+"</h2>",i+='<form method="post" action="ajaxAddToPlaylist" data-fvpupe-saveform>',i+='<ul class="fvpupe-list fvpupe-playlist-select" data-fvpupe-playlist-select>',t.each(l.playlists,(function(e,l){var s=!1;t.each(l.videos,(function(t,e){if(e.video_id==a&&e.page_id==p)return s=!0,!1})),i+=`\n\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<input type="checkbox" ${s?'checked="checked"':""} value="${l.ID}" name="fvpupe-playlists[]" /> <span>${l.post_title}</span>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t`})),i+="</ul>",i+='<input type="hidden" name="fvpupe-videoid" value="'+a+'" />',i+='<input type="hidden" name="fvpupe-pageid" value="'+p+'" />',i+="</form>"),"3"!=l.status&&(i+=`\n\t\t\t\t\t<a href="#" class="fvpupe-button fvpupe-positive" data-fvpupe-toggle-button="group" data-fvpupe-toggle-value="create_form">${ajax.lang.create_new_playlist}</a>\n\t\t\t\t\t`),i+="</div>","3"!=l.status&&(i+='<div class="fvpupe-form fvpupe-hidden" data-fvpupe-toggle="group" data-fvpupe-toggle-value="create_form">',i+=fvpupe_playlist_form({playlist_id:0,video_id:a,page_id:p}),i+="</div>"),fvpupe_set_modal_content(i,!0)}))})),t("body").on("click","[data-fvpupe-submit]",(function(e){e.preventDefault(),t(this).closest("form").submit()})),t("body").on("click","[data-fvpupe-modal-close-button]",(function(t){t.preventDefault(),fvpupe_close_modal()})),t("body").on("click","[data-fvpupe-closemodal]",(function(t){t.preventDefault(),fvpupe_close_modal()})),t("body").on("click","[data-fvpupe-deleteplaylistconfirm]",(function(e){e.preventDefault();var a=t(this).attr("data-fvpupe-deleteplaylistconfirm"),p=t(this).is("[data-fvpupe-fromsingle]")?" data-fvpupe-fromsingle":"";fvpupe_create_modal(`\n\t\t\t<h2>${ajax.lang.delete_playlist}</h2>\n\t\t\t<p>${ajax.lang.delete_playlist_confirm_text}</p>\n\t\t\t<a href="#" class="fvpupe-button fvpupe-positive"${p} data-fvpupe-deleteplaylist="${a}">${ajax.lang.yes}</a> \n\t\t\t<a href="#" class="fvpupe-button fvpupe-neutral" data-fvpupe-closemodal>${ajax.lang.cancel}</a>\n\t\t`)})),t("body").on("click","[data-fvpupe-editplaylistname]",(function(e){e.preventDefault(),fvpupe_create_modal(ajax.lang.loading+"...");var a=t(this).attr("data-fvpupe-editplaylistname"),p=t(this).is("[data-fvpupe-fromsingle]"),l={action:"ajaxGetPlaylistById",id:a};t.post(ajax.url,l,(function(e){var l=t.parseJSON(e);fvpupe_set_modal_content(1==l.status?fvpupe_playlist_form({playlist_id:a,video_id:0,page_id:0,name:l.data.name,description:l.data.description,videos:l.data.videos,from_single:p}):"<em>"+l.message+"</em>",!0),1==l.status&&setTimeout((function(){t("[data-fvpupe-sortable-videos]").sortable({placeholder:"fvpupe-sortable-placeholder",stop:function(t,e){fvpupe_save_videos_order()}}),t("[data-fvpupe-sortable-videos]").disableSelection()}),400)}))})),t("body").on("click","[data-fvpupe-deleteplaylist]",(function(e){e.preventDefault();var a=t(this).attr("data-fvpupe-deleteplaylist"),p=t(this).is("[data-fvpupe-fromsingle]"),l={action:"ajaxDeleteUserPlaylist",playlist_id:a};t.post(ajax.url,l,(function(e){var l=t.parseJSON(e);p?setTimeout((function(){location.href=l.archive}),2e3):t('[data-fvpupe-userplaylist="'+a+'"]').fadeOut(200,(function(){t(this).remove()})),fvpupe_set_message(l.message,l.status),fvpupe_close_modal()}))})),t("body").on("click","[data-fvpupe-delete-video-from-playlist]",(function(e){e.preventDefault();var a=t(this).closest("[data-fvupe-edit-playlist-video-list]").attr("data-fvupe-edit-playlist-video-list"),p=t(this).closest("[data-fvpupe-video-id]").attr("data-fvpupe-video-id"),l=t(this).closest("[data-fvpupe-page-id]").attr("data-fvpupe-page-id"),i=t(this).closest("li"),s={action:"ajaxDeleteVideoFromPlaylist",playlist_id:a,video_id:p,page_id:l};t.post(ajax.url,s,(function(e){var a=t.parseJSON(e);i.fadeOut(200,(function(){t(this).remove()})),fvpupe_set_message(a.message,a.status)}))})),t("body").on("change",'[data-fvpupe-playlist-select] input[type="checkbox"]',(function(e){(e.preventDefault(),t(this).closest("form").hasClass("disabled"))||t(this).closest("form").submit()})),t("body").on("submit","[data-fvpupe-saveform]",(function(e){e.preventDefault();var a=t(this),p=a.serialize()+"&action="+a.attr("action");a.addClass("disabled"),t.post(ajax.url,p,(function(e){a.removeClass("disabled");var p=t.parseJSON(e);if(fvpupe_set_message(p.message,p.status),a.is("[data-fvpupe-aftersave]")&&1==p.status)for(var l=a.attr("data-fvpupe-aftersave").split(" "),i=0;i<l.length;i++){var s=l[i],d=window[s];"function"==typeof d&&("fvpupe_set_playlist_name"==s?d(a.find('[name="fvpupe-playlist-name"]').val(),a.find('[name="fvpupe-playlistid"]').val()):d())}}))})),t("body").on("click","[data-fvpupe-modal-overlay]",(function(t){t.preventDefault(),fvpupe_close_modal()})),t("body").on("click","[data-fvpupe-toggle-button]",(function(e){e.preventDefault();var a=t(this).attr("data-fvpupe-toggle-button"),p=t(this).attr("data-fvpupe-toggle-value"),l=t('[data-fvpupe-toggle="'+a+'"][data-fvpupe-toggle-value="'+p+'"]');t('[data-fvpupe-toggle="'+a+'"][data-fvpupe-toggle-value!="'+p+'"]').slideUp(200),l.slideDown(200)}))}));